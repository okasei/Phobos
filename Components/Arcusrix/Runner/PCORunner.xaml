<Window x:Class="Phobos.Components.Arcusrix.Runner.PCORunner"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Phobos.Components.Arcusrix.Runner"
        mc:Ignorable="d"
        Title="Phobos Runner"
        MinWidth="600"
        MaxWidth="1200"
        Height="160"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Icon="/Assets/Icons/phobos_icon_odda.ico"
        ShowInTaskbar="False"
        Topmost="True"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterScreen"
        Loaded="Window_Loaded"
        Deactivated="Window_Deactivated"
        PreviewKeyDown="Window_PreviewKeyDown">

    <Grid x:Name="RootGrid" Margin="30">
        <!-- 主容器 -->
        <Border x:Name="MainBorder"
                Background="{DynamicResource Background2Brush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="24"
                Padding="28,24"
                RenderTransformOrigin="0.5,0.5">
            <Border.Effect>
                <DropShadowEffect Color="Black" 
                                  BlurRadius="50" 
                                  ShadowDepth="12" 
                                  Opacity="0.5"
                                  Direction="270"/>
            </Border.Effect>
            <Border.RenderTransform>
                <TransformGroup>
                    <ScaleTransform x:Name="BorderScale" ScaleX="1" ScaleY="1"/>
                    <TranslateTransform x:Name="BorderTranslate" Y="0"/>
                </TransformGroup>
            </Border.RenderTransform>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- 运行图标 -->
                <Border Grid.Column="0"
                        Width="50"
                        Height="50"
                        CornerRadius="14"
                        Background="{DynamicResource PrimaryBrush}"
                        Margin="0,0,20,0">
                    <TextBlock Text="▶"
                               FontSize="24"
                               Foreground="White"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                </Border>

                <!-- 输入区域 -->
                <Grid Grid.Column="1">
                    <!-- 占位符文本 -->
                    <TextBlock x:Name="PlaceholderText"
                               Margin="15,0,0,0"
                               Text="输入要运行的命令、文件或程序..."
                               FontSize="20"
                               FontFamily="{DynamicResource FontPrimary}"
                               Foreground="{DynamicResource Foreground4Brush}"
                               VerticalAlignment="Center"
                               IsHitTestVisible="False"
                               Opacity="0.6"/>

                    <!-- 输入框 -->
                    <TextBox x:Name="InputTextBox"
                             Background="Transparent"
                             Foreground="{DynamicResource Foreground1Brush}"
                             BorderThickness="0"
                             FontSize="20"
                             FontFamily="{DynamicResource FontPrimary}"
                             CaretBrush="{DynamicResource PrimaryBrush}"
                             VerticalAlignment="Center"
                             VerticalContentAlignment="Center"
                             TextChanged="InputTextBox_TextChanged"
                             KeyDown="InputTextBox_KeyDown"/>
                </Grid>

                <!-- 清空按钮 -->
                <Border x:Name="ClearButton"
                        Grid.Column="2"
                        Width="40"
                        Height="40"
                        CornerRadius="10"
                        Background="Transparent"
                        Margin="16,0,0,0"
                        Cursor="Hand"
                        Visibility="Collapsed"
                        MouseLeftButtonUp="ClearButton_Click"
                        MouseEnter="ClearButton_MouseEnter"
                        MouseLeave="ClearButton_MouseLeave"
                        RenderTransformOrigin="0.5,0.5">
                    <Border.RenderTransform>
                        <ScaleTransform x:Name="ClearButtonScale" ScaleX="1" ScaleY="1"/>
                    </Border.RenderTransform>
                    <TextBlock Text="✕"
                               FontSize="25"
                               FontWeight="Bold"
                               Foreground="{DynamicResource Foreground3Brush}"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                </Border>
            </Grid>
        </Border>

        <!-- 建议列表弹出层 -->
        <Popup x:Name="SuggestionsPopup"
               PlacementTarget="{Binding ElementName=MainBorder}"
               Placement="Bottom"
               StaysOpen="True"
               AllowsTransparency="True"
               PopupAnimation="None"
               VerticalOffset="32"
               HorizontalOffset="0">
            <!-- 外层容器为阴影和动画提供空间 -->
            <Grid Margin="40,20,40,40">
                <Border x:Name="SuggestionsBorder"
                        Background="{DynamicResource Background2Brush}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="20"
                        MaxHeight="450"
                        Padding="6">
                    <Border.Effect>
                        <DropShadowEffect Color="Black"
                                          BlurRadius="35"
                                          ShadowDepth="8"
                                          Opacity="0.4"/>
                    </Border.Effect>
                    <Border.RenderTransform>
                        <TransformGroup>
                            <ScaleTransform x:Name="SuggestionsScale" ScaleX="1" ScaleY="1"/>
                            <TranslateTransform x:Name="SuggestionsTranslate" Y="0"/>
                        </TransformGroup>
                    </Border.RenderTransform>
                    <Border.RenderTransformOrigin>
                        <Point X="0.5" Y="0"/>
                    </Border.RenderTransformOrigin>
                    <ScrollViewer VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled"
                                  Style="{DynamicResource PhobosScrollViewer}">
                        <StackPanel x:Name="SuggestionsPanel" ClipToBounds="False"/>
                    </ScrollViewer>
                </Border>
            </Grid>
        </Popup>
    </Grid>
</Window>
