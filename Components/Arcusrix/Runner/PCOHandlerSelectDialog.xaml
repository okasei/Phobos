<Window x:Class="Phobos.Components.Arcusrix.Runner.PCOHandlerSelectDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Phobos.Components.Arcusrix.Runner"
        Title="Open With"
        Width="400"
        Height="Auto"
        MinHeight="200"
        MaxHeight="500"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterScreen"
        SizeToContent="Height"
        ShowInTaskbar="False"
        Loaded="Window_Loaded">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>

    <Border x:Name="MainBorder"
            Background="{DynamicResource Background2Brush}"
            BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="8"
            Padding="20"
            RenderTransformOrigin="0.5,0.5">

        <Border.RenderTransform>
            <TransformGroup>
                <ScaleTransform x:Name="DialogScale" ScaleX="1" ScaleY="1"/>
                <TranslateTransform x:Name="DialogTranslate" Y="0"/>
            </TransformGroup>
        </Border.RenderTransform>

        <Border.Effect>
            <DropShadowEffect Color="Black"
                              BlurRadius="20"
                              ShadowDepth="0"
                              Opacity="0.3"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 标题区域 -->
            <StackPanel Grid.Row="0" Margin="0,0,0,16">
                <TextBlock x:Name="TitleText"
                           Text="How do you want to open this?"
                           FontSize="{DynamicResource FontSizeLg}"
                           FontWeight="{DynamicResource FontWeightSemibold}"
                           Foreground="{DynamicResource Foreground1Brush}"
                           TextWrapping="Wrap"/>
                <TextBlock x:Name="SubtitleText"
                           Text=""
                           FontSize="{DynamicResource FontSizeSm}"
                           Foreground="{DynamicResource Foreground3Brush}"
                           TextWrapping="Wrap"
                           Margin="0,4,0,0"
                           Visibility="Collapsed"/>
            </StackPanel>

            <!-- 分隔线 -->
            <Border Grid.Row="1"
                    Height="1"
                    Background="{DynamicResource BorderBrush}"
                    Margin="0,0,0,12"/>

            <!-- 处理器列表 -->
            <ScrollViewer Grid.Row="2"
                          Style="{StaticResource PhobosScrollViewer}"
                          VerticalScrollBarVisibility="Auto"
                          MaxHeight="280"
                          Margin="0,0,0,16">
                <ItemsControl x:Name="HandlerList">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border x:Name="ItemBorder"
                                    Background="Transparent"
                                    CornerRadius="6"
                                    Padding="12,10"
                                    Margin="0,0,0,4"
                                    Cursor="Hand"
                                    MouseLeftButtonDown="HandlerItem_Click"
                                    MouseEnter="HandlerItem_MouseEnter"
                                    MouseLeave="HandlerItem_MouseLeave">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="40"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 图标 -->
                                    <Border Grid.Column="0"
                                            Width="32"
                                            Height="32"
                                            Background="{DynamicResource Background3Brush}"
                                            CornerRadius="6">
                                        <Image Source="{Binding IconPath}"
                                               Width="24"
                                               Height="24"
                                               Stretch="Uniform"
                                               RenderOptions.BitmapScalingMode="HighQuality"/>
                                    </Border>

                                    <!-- 名称和描述 -->
                                    <StackPanel Grid.Column="1"
                                                VerticalAlignment="Center"
                                                Margin="12,0,0,0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding DisplayName}"
                                                       FontSize="{DynamicResource FontSizeMd}"
                                                       FontWeight="{DynamicResource FontWeightMedium}"
                                                       Foreground="{DynamicResource Foreground1Brush}"/>
                                            <!-- 新标记 -->
                                            <Border x:Name="NewBadge"
                                                    Background="{DynamicResource SuccessBrush}"
                                                    CornerRadius="4"
                                                    Padding="6,2"
                                                    Margin="8,0,0,0"
                                                    Visibility="{Binding IsNew, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <TextBlock Text="New"
                                                           FontSize="{DynamicResource FontSizeXs}"
                                                           FontWeight="{DynamicResource FontWeightMedium}"
                                                           Foreground="White"/>
                                            </Border>
                                        </StackPanel>
                                        <TextBlock Text="{Binding Description}"
                                                   FontSize="{DynamicResource FontSizeXs}"
                                                   Foreground="{DynamicResource Foreground3Brush}"
                                                   TextTrimming="CharacterEllipsis"
                                                   Visibility="{Binding HasDescription, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                            <DataTemplate.Triggers>
                                <DataTrigger Binding="{Binding IsNew}" Value="True">
                                    <Setter TargetName="ItemBorder" Property="Background" Value="{DynamicResource Background3Brush}"/>
                                </DataTrigger>
                            </DataTemplate.Triggers>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <!-- 底部区域：设为默认复选框 -->
            <StackPanel Grid.Row="3">
                <Border Height="1"
                        Background="{DynamicResource BorderBrush}"
                        Margin="0,0,0,12"/>
                <CheckBox x:Name="SetDefaultCheckBox"
                          Style="{StaticResource PhobosCheckBox}"
                          Content="Always use this app"
                          FontSize="{DynamicResource FontSizeSm}"
                          Foreground="{DynamicResource Foreground2Brush}"
                          IsChecked="False"/>
            </StackPanel>
        </Grid>
    </Border>
</Window>
